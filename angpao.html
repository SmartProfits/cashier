<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á∫¢ÂåÖÊäΩÂ•ñ</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        h2 {
            color: #e74c3c;
            margin-bottom: 25px;
            font-size: 24px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        input {
            width: 80%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #e74c3c;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        input:focus {
            border-color: #c0392b;
            box-shadow: 0 0 8px rgba(231, 76, 60, 0.4);
        }

        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin: 15px 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }

        button:hover {
            background: #c0392b;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }

        .hidden {
            display: none;
        }

        .result {
            font-size: 28px;
            color: #e74c3c;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            background: rgba(231, 76, 60, 0.1);
            animation: fadeIn 0.5s ease;
        }

        .remaining {
            font-size: 16px;
            color: #7f8c8d;
            margin-top: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .red-packet {
            width: 120px;
            height: 120px;
            margin: 0 auto 20px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23e74c3c" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>') no-repeat center;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Êñ∞Â¢ûÂêçÂçïÊ†∑Âºè */
        .layout {
            display: flex;
            gap: 20px;
            max-width: 1000px;
            width: 95%;
            margin: 0 auto;
        }

        .winners-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 20px;
            width: 300px;
            max-height: 600px;
            overflow-y: auto;
        }

        .winner-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }
            .winners-list {
                width: auto;
                max-height: 300px;
            }
        }

        .status-info {
            background: rgba(231, 76, 60, 0.1);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-size: 14px;
            color: #e74c3c;
        }

        /* Ê∑ªÂä†ÊäΩÂ•ñÂä®ÁîªÁõ∏ÂÖ≥Ê†∑Âºè */
        .lottery-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .rolling-number {
            font-size: 72px;
            color: #e74c3c;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .drum-roll {
            font-size: 24px;
            color: #fff;
            margin-top: 20px;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shaking {
            animation: shake 0.1s infinite;
        }

        .share-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            text-align: center;
        }

        .share-section h3 {
            color: #e74c3c;
            margin-bottom: 10px;
        }

        .share-link {
            word-break: break-all;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            margin: 10px 0;
        }

        .qr-code {
            margin: 15px auto;
        }

        .copy-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #27ae60;
        }
    </style>
    <!-- Ê∑ªÂä†QRÁ†ÅÁîüÊàêÂ∫ì -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode.js@1.0.0/qrcode.min.js"></script>
    <!-- Âú®</head>ÂâçÊ∑ªÂä†Firebase SDK -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getDatabase, ref, set, push, onValue, get, child } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBO5zgKEHDE4hkVdWOVVpcpodB7Sl1UUro",
        authDomain: "angpao-da62f.firebaseapp.com",
        databaseURL: "https://angpao-da62f-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "angpao-da62f",
        storageBucket: "angpao-da62f.firebasestorage.app",
        messagingSenderId: "303412944902",
        appId: "1:303412944902:web:0e9c30451c4cc37258a387",
        measurementId: "G-WDX94CKZ1Q"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // Â∞ÜFirebaseÂÆû‰æãÊö¥Èú≤ÁªôÂÖ®Â±Ä‰ΩúÁî®Âüü
      window.db = db;
      window.dbRef = ref;
      window.dbSet = set;
      window.dbPush = push;
      window.dbOnValue = onValue;
      window.dbGet = get;
      window.dbChild = child;
    </script>
</head>
<body>
    <div class="layout">
        <div class="container">
            <div id="adminPanel">
                <h2>üßß Á∫¢ÂåÖÁÆ°ÁêÜËÆæÁΩÆ</h2>
                <input type="number" id="totalAmount" placeholder="ËÆæÁΩÆÊÄªÈáëÈ¢ù (RM)">
                <input type="number" id="maxParticipants" placeholder="ËÆæÁΩÆÊäΩÂ•ñ‰∫∫Êï∞">
                <input type="password" id="setPassword" placeholder="ËÆæÁΩÆËÆøÈóÆÂØÜÁ†Å">
                <button onclick="setupGame()">Á°ÆËÆ§ËÆæÁΩÆ</button>
            </div>

            <div id="userPanel" class="hidden">
                <div class="red-packet"></div>
                <h2>üéâ Á∫¢ÂåÖÊäΩÂ•ñ</h2>
                <div class="status-info" id="participantStatus"></div>
                <input type="password" id="password" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å">
                <button onclick="checkPassword()">ÂºÄÂßãÊäΩÂ•ñ</button>
            </div>

            <div id="lotteryPanel" class="hidden">
                <div class="red-packet"></div>
                <h2>üéä ÊäΩÂ•ñÈù¢Êùø</h2>
                <div class="status-info" id="lotteryStatus"></div>
                <input type="text" id="userName" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂêçÂ≠ó">
                <button onclick="drawLottery()">Á´ãÂç≥ÊäΩÂ•ñ</button>
                <div id="result" class="result"></div>
            </div>

            <!-- Ê∑ªÂä†ÂàÜ‰∫´ÈÉ®ÂàÜ -->
            <div id="shareSection" class="share-section hidden">
                <h3>ÂàÜ‰∫´ÈìæÊé•</h3>
                <div class="share-link" id="shareLink"></div>
                <button class="copy-btn" onclick="copyLink()">Â§çÂà∂ÈìæÊé•</button>
                <div id="qrcode" class="qr-code"></div>
            </div>
        </div>

        <div class="winners-list hidden" id="winnersList">
            <h2>üèÜ ‰∏≠Â•ñÂêçÂçï</h2>
            <div id="winnersContainer"></div>
        </div>
    </div>

    <script>
        let gamePassword = '';
        let totalAmount = 0;
        let remainingAmount = 0;
        let participants = [];
        let maxParticipants = 0;
        const MIN_AMOUNT = 10; // ËÆæÁΩÆÊúÄ‰ΩéÈáëÈ¢ù‰∏∫10

        function updateStatus() {
            const remainingSpots = maxParticipants - participants.length;
            const participantStatus = document.getElementById('participantStatus');
            const lotteryStatus = document.getElementById('lotteryStatus');
            const statusText = `Ââ©‰ΩôÂêçÈ¢ù: ${remainingSpots} / ÊÄª‰∫∫Êï∞: ${maxParticipants}`;
            
            if (participantStatus) {
                participantStatus.innerHTML = statusText;
            }
            if (lotteryStatus) {
                lotteryStatus.innerHTML = statusText;
            }
        }

        async function setupGame() {
            console.log('Setup game started');
            console.log('Amount:', document.getElementById('totalAmount').value);
            console.log('Password:', document.getElementById('setPassword').value);
            console.log('Participants:', document.getElementById('maxParticipants').value);

            try {
                const amount = document.getElementById('totalAmount').value;
                const password = document.getElementById('setPassword').value;
                const participants = document.getElementById('maxParticipants').value;
                
                if (!amount || !password || !participants) {
                    alert('ËØ∑Â°´ÂÜôÊâÄÊúâËÆæÁΩÆÈ°πÔºÅ');
                    return;
                }

                if (amount % 5 !== 0) {
                    alert('ËØ∑ËæìÂÖ•5ÁöÑÂÄçÊï∞ÈáëÈ¢ùÔºÅ');
                    return;
                }

                if (participants < 1) {
                    alert('ÂèÇ‰∏é‰∫∫Êï∞ÂøÖÈ°ªÂ§ß‰∫é0ÔºÅ');
                    return;
                }

                // Á°Æ‰øùÊÄªÈáëÈ¢ùË∂≥Â§üÊØè‰∫∫Ëá≥Â∞ëÂàÜÂà∞10ÂÖÉ
                if (amount < participants * MIN_AMOUNT) {
                    alert(`ÊÄªÈáëÈ¢ùÂøÖÈ°ªËá≥Â∞ëËÉΩ‰øùËØÅÊØè‰∫∫Ëé∑Âæó${MIN_AMOUNT}ÂÖÉÔºÅ`);
                    return;
                }

                // ÂàõÂª∫Êñ∞Ê∏∏Êàè
                const gameRef = dbPush(dbRef(db, 'games'));
                const gameId = gameRef.key;
                console.log('Game ID created:', gameId); // Ë∞ÉËØï‰ø°ÊÅØ
                
                await dbSet(gameRef, {
                    totalAmount: parseFloat(amount),
                    remainingAmount: parseFloat(amount),
                    gamePassword: password,
                    maxParticipants: parseInt(participants),
                    participants: [],
                    winners: [],
                    createdAt: Date.now()
                }).then(() => {
                    console.log('Game data saved successfully'); // Ë∞ÉËØï‰ø°ÊÅØ
                }).catch(error => {
                    console.error('Error saving game data:', error); // ÈîôËØØ‰ø°ÊÅØ
                    alert('‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆÊó∂Âá∫ÈîôÔºö' + error.message);
                    return;
                });

                // Â∞ÜÊ∏∏ÊàèIDÊ∑ªÂä†Âà∞URL
                window.history.pushState({}, '', `?game=${gameId}`);
                
                totalAmount = parseFloat(amount);
                remainingAmount = totalAmount;
                gamePassword = password;
                maxParticipants = parseInt(participants);
                
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('userPanel').classList.remove('hidden');
                document.getElementById('winnersList').classList.remove('hidden');
                
                // ÊòæÁ§∫ÂàÜ‰∫´ÈÉ®ÂàÜ
                showShareSection();
                
                updateStatus();
                alert('Ê∏∏ÊàèËÆæÁΩÆÊàêÂäüÔºÅ');
                
                // ÂºÄÂßãÁõëÂê¨Ê∏∏ÊàèÁä∂ÊÄÅ
                initializeGameListeners(gameId);

            } catch (error) {
                console.error('Setup game error:', error); // ÈîôËØØ‰ø°ÊÅØ
                alert('ËÆæÁΩÆÊ∏∏ÊàèÊó∂Âá∫ÈîôÔºö' + error.message);
            }
        }

        function initializeGameListeners(gameId) {
            try {
                console.log('Initializing game listeners for ID:', gameId);
                const gameRef = dbRef(db, `games/${gameId}`);
                
                dbOnValue(gameRef, (snapshot) => {
                    const gameData = snapshot.val();
                    console.log('Game data received:', gameData);
                    
                    if (!gameData) {
                        console.log('No game data found');
                        return;
                    }

                    // Êõ¥Êñ∞ÁïåÈù¢Áä∂ÊÄÅ
                    totalAmount = gameData.totalAmount;
                    remainingAmount = gameData.remainingAmount;
                    gamePassword = gameData.gamePassword;
                    maxParticipants = gameData.maxParticipants;
                    participants = gameData.participants || [];
                    
                    // Êõ¥Êñ∞Áä∂ÊÄÅÂíå‰∏≠Â•ñÂêçÂçï
                    updateStatus();
                    updateWinnersList(gameData.winners || []);
                    
                    // ÊòæÁ§∫‰∏≠Â•ñÂêçÂçïÂÆπÂô®
                    document.getElementById('winnersList').classList.remove('hidden');
                }, (error) => {
                    console.error('Error listening to game data:', error);
                    alert('ÁõëÂê¨Ê∏∏ÊàèÊï∞ÊçÆÊó∂Âá∫ÈîôÔºö' + error.message);
                });
            } catch (error) {
                console.error('Initialize listeners error:', error);
                alert('ÂàùÂßãÂåñÊ∏∏ÊàèÁõëÂê¨Âô®Êó∂Âá∫ÈîôÔºö' + error.message);
            }
        }

        function checkPassword() {
            const inputPassword = document.getElementById('password').value;
            if (inputPassword === gamePassword) {
                document.getElementById('userPanel').classList.add('hidden');
                document.getElementById('lotteryPanel').classList.remove('hidden');
            } else {
                alert('ÂØÜÁ†ÅÈîôËØØÔºÅ');
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        async function showLotteryAnimation(finalAmount) {
            // ÂàõÂª∫Âä®ÁîªÂÆπÂô®
            const animationContainer = document.createElement('div');
            animationContainer.className = 'lottery-animation';
            
            const numberDisplay = document.createElement('div');
            numberDisplay.className = 'rolling-number shaking';
            
            const drumRoll = document.createElement('div');
            drumRoll.className = 'drum-roll';
            drumRoll.textContent = 'ÊäΩÂ•ñ‰∏≠...';
            
            animationContainer.appendChild(numberDisplay);
            animationContainer.appendChild(drumRoll);
            document.body.appendChild(animationContainer);

            // Êí≠ÊîæÊªöÂä®Âä®Áîª
            const steps = 30; // Âä®ÁîªÊ≠•Êï∞
            const duration = 3000; // ÊÄªÊåÅÁª≠Êó∂Èó¥ÔºàÊØ´ÁßíÔºâ
            const stepDuration = duration / steps;
            
            for (let i = 0; i < steps; i++) {
                const randomAmount = Math.floor(Math.random() * (finalAmount * 2) / 5) * 5;
                numberDisplay.textContent = `RM ${randomAmount}`;
                await sleep(stepDuration);
            }

            // ÊúÄÂêéÊòæÁ§∫ÂÆûÈôÖÈáëÈ¢ù
            numberDisplay.classList.remove('shaking');
            numberDisplay.style.fontSize = '96px';
            numberDisplay.style.color = '#f1c40f';
            numberDisplay.textContent = `RM ${finalAmount}`;
            drumRoll.textContent = 'ÊÅ≠ÂñúÔºÅ';

            // Á≠âÂæÖ‰∏Ä‰ºöÂêéÁßªÈô§Âä®Áîª
            await sleep(1500);
            animationContainer.style.animation = 'fadeOut 0.3s ease';
            await sleep(300);
            document.body.removeChild(animationContainer);
        }

        async function drawLottery() {
            try {
                const gameId = new URLSearchParams(window.location.search).get('game');
                if (!gameId) {
                    alert('Êó†ÊïàÁöÑÊ∏∏ÊàèIDÔºÅ');
                    return;
                }

                const name = document.getElementById('userName').value;
                if (!name) {
                    alert('ËØ∑ËæìÂÖ•ÊÇ®ÁöÑÂêçÂ≠óÔºÅ');
                    return;
                }

                // Ëé∑ÂèñÊúÄÊñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
                const gameRef = dbRef(db, `games/${gameId}`);
                const snapshot = await dbGet(gameRef);
                const gameData = snapshot.val();

                if (!gameData) {
                    alert('Ê∏∏Êàè‰∏çÂ≠òÂú®ÔºÅ');
                    return;
                }

                if (gameData.participants && gameData.participants.includes(name)) {
                    alert('ÊÇ®Â∑≤ÁªèÂèÇ‰∏éËøáÊäΩÂ•ñ‰∫ÜÔºÅ');
                    return;
                }

                if (gameData.participants && gameData.participants.length >= gameData.maxParticipants) {
                    alert('ÊäΩÂ•ñ‰∫∫Êï∞Â∑≤Ëææ‰∏äÈôêÔºÅ');
                    return;
                }

                // ËÆ°ÁÆóÊäΩÂ•ñÈáëÈ¢ù
                const remainingPeople = gameData.maxParticipants - (gameData.participants ? gameData.participants.length : 0) - 1;
                let amount = calculatePrizeAmount(gameData.remainingAmount, remainingPeople);

                // Êí≠ÊîæÂä®Áîª
                await showLotteryAnimation(amount);

                // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
                const newParticipants = gameData.participants ? [...gameData.participants, name] : [name];
                const newWinners = gameData.winners ? [...gameData.winners] : [];
                newWinners.push({
                    name: name,
                    amount: amount,
                    timestamp: Date.now()
                });
                
                // Êõ¥Êñ∞FirebaseÊï∞ÊçÆ
                await dbSet(gameRef, {
                    ...gameData,
                    remainingAmount: gameData.remainingAmount - amount,
                    participants: newParticipants,
                    winners: newWinners
                });

                // Á´ãÂç≥Êõ¥Êñ∞ÊòæÁ§∫
                updateWinnersList(newWinners);
                
                // ÊòæÁ§∫ÁªìÊûú
                document.getElementById('result').textContent = `ÊÅ≠ÂñúËé∑Âæó RM ${amount}!`;
                
            } catch (error) {
                console.error('Draw lottery error:', error);
                alert('ÊäΩÂ•ñËøáÁ®ã‰∏≠Âá∫ÈîôÔºö' + error.message);
            }
        }

        function updateWinnersList(winners) {
            const winnersContainer = document.getElementById('winnersContainer');
            const winnersList = document.getElementById('winnersList');
            
            // Á°Æ‰øù‰∏≠Â•ñÂêçÂçïÂÆπÂô®ÂèØËßÅ
            winnersList.classList.remove('hidden');
            winnersContainer.innerHTML = '';
            
            if (!winners || winners.length === 0) {
                winnersContainer.innerHTML = '<div class="winner-item">ÊöÇÊó†‰∏≠Â•ñËÆ∞ÂΩï</div>';
                return;
            }
            
            // ÊåâÊó∂Èó¥ÂÄíÂ∫èÊéíÂàó‰∏≠Â•ñËÆ∞ÂΩï
            winners.sort((a, b) => b.timestamp - a.timestamp).forEach(winner => {
                const winnerItem = document.createElement('div');
                winnerItem.className = 'winner-item';
                winnerItem.innerHTML = `
                    <span>${winner.name}</span>
                    <span>RM ${winner.amount}</span>
                `;
                winnersContainer.appendChild(winnerItem);
            });
        }

        function showShareSection() {
            const shareSection = document.getElementById('shareSection');
            const shareLinkDiv = document.getElementById('shareLink');
            const qrcodeDiv = document.getElementById('qrcode');
            
            // Ëé∑ÂèñÂΩìÂâçÈ°µÈù¢URL
            const currentUrl = window.location.href;
            
            // ÊòæÁ§∫ÈìæÊé•
            shareLinkDiv.textContent = currentUrl;
            shareSection.classList.remove('hidden');
            
            // ÁîüÊàê‰∫åÁª¥Á†Å
            qrcodeDiv.innerHTML = ''; // Ê∏ÖÈô§‰πãÂâçÁöÑ‰∫åÁª¥Á†Å
            new QRCode(qrcodeDiv, {
                text: currentUrl,
                width: 128,
                height: 128,
                colorDark : "#e74c3c",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        function copyLink() {
            const shareLinkDiv = document.getElementById('shareLink');
            const text = shareLinkDiv.textContent;
            
            // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
            navigator.clipboard.writeText(text).then(() => {
                const copyBtn = document.querySelector('.copy-btn');
                copyBtn.textContent = 'Â∑≤Â§çÂà∂ÔºÅ';
                copyBtn.style.background = '#e74c3c';
                
                setTimeout(() => {
                    copyBtn.textContent = 'Â§çÂà∂ÈìæÊé•';
                    copyBtn.style.background = '#2ecc71';
                }, 2000);
            }).catch(err => {
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂ÈìæÊé•');
            });
        }

        function calculatePrizeAmount(remainingAmount, remainingPeople) {
            if (remainingPeople === 0) {
                return Math.floor(remainingAmount / 5) * 5; // ÊúÄÂêé‰∏Ä‰∏™‰∫∫Ëé∑ÂæóÊâÄÊúâÂâ©‰ΩôÈáëÈ¢ù
            }

            // Á°Æ‰øùÊØè‰∏™‰∫∫Ëá≥Â∞ëËÉΩËé∑ÂæóÊúÄ‰ΩéÈáëÈ¢ù
            const minAmount = 10;
            const maxAmount = remainingAmount - (remainingPeople * minAmount);
            
            if (maxAmount <= 0) {
                return minAmount; // Â¶ÇÊûúÂâ©‰ΩôÈáëÈ¢ù‰∏çË∂≥ÔºåËøîÂõûÊúÄ‰ΩéÈáëÈ¢ù
            }

            // ÁîüÊàêÈöèÊú∫ÈáëÈ¢ùÔºåÁ°Æ‰øùÊòØ5ÁöÑÂÄçÊï∞
            let randomAmount = Math.floor(Math.random() * maxAmount);
            randomAmount = Math.floor(randomAmount / 5) * 5;
            
            // Á°Æ‰øùÈáëÈ¢ù‰∏çÂ∞è‰∫éÊúÄ‰ΩéÈáëÈ¢ù
            return Math.max(randomAmount, minAmount);
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•URLÊòØÂê¶ÂåÖÂê´Ê∏∏ÊàèID
        window.addEventListener('load', () => {
            console.log('Page loaded');
            const gameId = new URLSearchParams(window.location.search).get('game');
            console.log('Game ID from URL:', gameId);
            if (gameId) {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('userPanel').classList.remove('hidden');
                document.getElementById('winnersList').classList.remove('hidden');
                initializeGameListeners(gameId);
            }
        });
    </script>
</body>
</html>
