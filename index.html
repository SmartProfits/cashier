<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cashier Tools</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 15px;
            margin: 0;
            background-color: #1c1c1c;
            color: #e0e0e0;
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #1c1c1c;
            color: #e0e0e0;
        }

        .category-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        #suggestions {
            border: 1px solid #ccc;
            max-height: 150px;
            overflow-y: auto;
            background-color: white;
            position: absolute;
            width: 170px;
            z-index: 10;
        }

        .contact-info {
            font-size: 1rem;
            /* Â≠ó‰ΩìÂ§ßÂ∞è */
            font-style: italic;
            /* Êñú‰Ωì */
            color: #555;
            /* ÊµÖÁÅ∞Ëâ≤Â≠ó‰Ωì */
            text-align: center;
            /* Â±Ö‰∏≠ÂØπÈΩê */
            background-color: #f9f9f9;
            /* ÊüîÂíåÁöÑËÉåÊôØËâ≤ */
            padding: 10px;
            /* ÂÜÖËæπË∑ù */
            border-radius: 8px;
            /* ÂúÜËßíËæπÊ°Ü */
            margin-bottom: 20px;
            /* ‰∏é‰∏ãÊñπÂÜÖÂÆπÁöÑÈó¥Ë∑ù */
            border: 1px solid #ddd;
            /* ÊµÖËâ≤ËæπÊ°Ü */
        }

        #suggestions div {
            padding: 8px;
            cursor: pointer;
            color: #333;
        }

        #suggestions div:hover {
            background-color: #f0f0f0;
        }

        #productList div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        #productList label {
            flex-grow: 1;
            margin-right: 10px;
        }

        input[type="number"] {
            width: 80px;
            margin-left: 10px;
            text-align: right;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 110px;
        }

        #result {
            width: 100%;
            height: 250px;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
            overflow: auto;
            font-size: 1.1rem;
            color: black;
            background-color: #fff;
            border-radius: 8px;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        button {
            padding: 5px 10px;
            font-size: 1rem;
            margin: 0 5px;
            cursor: pointer;
        }

        span {
            font-size: 1.2rem;
        }

        .toggle-mode-btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            margin-bottom: 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            font-size: 1rem;
        }

        .saved-button {
            background-color: #007bff;
        }

        #searchBar {
            width: 150px;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1.1rem;
        }

        .payment-section {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background-color: #2c2c2c;
        }

        .payment-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .payment-option {
            padding: 15px 10px;
            border-radius: 8px;
            background-color: #3c3c3c;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 60px;
        }

        .payment-option span {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .payment-option span i {
            font-size: 1.5rem;
        }

        .payment-option:hover {
            background-color: #4c4c4c;
            transform: translateY(-2px);
        }

        .payment-option.selected {
            background-color: #007bff;
            color: white;
        }

        /* Ê∑ªÂä†ÂìçÂ∫îÂºèËÆæËÆ° */
        @media screen and (max-width: 600px) {
            .payment-options {
                grid-template-columns: repeat(3, 1fr);
            }

            .payment-option {
                padding: 10px 5px;
                min-height: 50px;
            }

            .payment-option span {
                font-size: 0.8rem;
            }

            /* ÈíàÂØπÂ∞èÂ±èÂπï‰ºòÂåñÊ®°ÊÄÅÊ°Ü */
            #modalContainer {
                width: 90%;
                /* Âç†Êª°Â§ßÈÉ®ÂàÜÂ±èÂπï */
                max-height: 70%;
                /* È´òÂ∫¶‰∏çË∂ÖËøáÂ±èÂπïÁöÑ 70% */
            }

            #modalContainer button {
                font-size: 1rem;
                /* Ë∞ÉÊï¥ÊåâÈíÆÂ≠ó‰ΩìÂ§ßÂ∞è */
                padding: 10px;
                /* Â¢ûÂä†ÊåâÈíÆÁöÑÁÇπÂáªÂå∫Âüü */
            }
        }

        /* Ê®°ÊÄÅÊ°ÜÂÖ¨ÂÖ±Ê†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            color: black;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            max-height: 80%;
            overflow-y: auto;
        }

        .modal button {
            margin-top: 20px;
            background-color: red;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            width: 100%;
        }

        .close-button {
            background-color: #007bff;
        }

    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

    <div class="header">
        <h1>Sales Listing</h1>
    </div>

    <div class="search-container" style="position: relative;">
        <input type="text" id="searchBar" placeholder="Search for items..." onfocus="this.value=''"
            onkeyup="searchItems()">
        <div id="suggestions"></div>
    </div>

    <h3>Category</h3>
    <div class="category-container" id="categoryContainer"></div>

    <div id="productList"></div>

    <div class="payment-section" style="display: none;">
        <h3>Payment Method</h3>
        <div class="payment-options">
            <label class="payment-option">
                <input type="radio" name="store" value="Cash" onclick="toggleCashInput(); updateResult(); selectPayment(this)">
                <span>
                    üíµ<br>
                    Cash
                </span>
            </label>
            <label class="payment-option">
                <input type="radio" name="store" value="Card" onclick="hideCashInput(); updateResult(); selectPayment(this)">
                <span>
                    üí≥<br>
                    Card
                </span>
            </label>
            <label class="payment-option">
                <input type="radio" name="store" value="E-Wallet" onclick="hideCashInput(); updateResult(); selectPayment(this)">
                <span>
                    üì±<br>
                    E-wallet
                </span>
            </label>
        </div>
    </div>

    <div id="cashInputContainer" style="display: none;">
        <input type="number" id="cashAmount" placeholder="Enter cash amount"
            style="background-color: white; color: black; padding: 5px;"
            oninput="calculateChange()">
        <div id="changeAmount" style="color: #e0e0e0; margin-left: 10px; display: inline-block;"></div>
    </div>

    <div class="action-buttons">
        <button onclick="clearAll()">Next Customer</button>
        <span id="currentBillDisplay" style="margin-left: 10px; font-weight: bold;">Current Bill: 001</span>
    </div>

    <div id="result"></div>

    <div>
        <h3>Search or Delete Bill</h3>
        <input type="text" id="billSearchInput" placeholder="Enter bill number (e.g., 001)">
        <button onclick="searchBill(document.getElementById('billSearchInput').value)">Search</button>
        <button onclick="deleteBill()">Delete</button>
    </div>

    <div>
        <button onclick="showSalesClosing()" style="margin-top: 20px; padding: 10px 20px; font-size: 16px;">Sales Closing</button>
    </div>

    <script>
        // Firebase ÈÖçÁΩÆ
        const firebaseConfig = {
            apiKey: "AIzaSyCsK-jF0s5losIGNrlxmD83UCzAsXi7gaQ",
            authDomain: "sales-listing-8d2d7.firebaseapp.com",
            databaseURL: "https://sales-listing-8d2d7-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sales-listing-8d2d7",
            storageBucket: "sales-listing-8d2d7.firebasestorage.app",
            messagingSenderId: "893973257981",
            appId: "1:893973257981:web:40cfb9612babe692e76894",
            measurementId: "G-JQ8RWV1S7C"
        };

        // ÂàùÂßãÂåñ Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ÂàÜÁ±ªÂïÜÂìÅ
       const categories = {
    BanHeang: [
        { id: 101, name: "Tambun Original", price: 17.90 },
        { id: 102, name: "Tambun Pandan", price: 17.90 },
        { id: 103, name: "Tambun White Lotus", price: 20.80 },
        { id: 104, name: "Tau Sar Pheah", price: 16.80 },
        { id: 105, name: "Heong Pheah", price: 16.80 },
        { id: 106, name: "Beh Teh Saw", price: 16.80 },
        { id: 107, name: "Phong Pheah", price: 16.80 },
        { id: 108, name: "Pepper Biscuit", price: 0 },
        { id: 109, name: "Hup Toh Soh", price: 16.80 },
        { id: 110, name: "Omlette Crisp Chocolate", price: 19.80 },
        { id: 111, name: "Omlette Crisp Pandan", price: 19.80 },
        { id: 112, name: "Kai Chai Biscuit", price: 14.80 },
        { id: 113, name: "Almond Slice", price: 0 },
        { id: 114, name: "Almond Slice Salted Egg", price: 0 },
        { id: 115, name: "Durian Crisp", price: 17.80 },
        { id: 116, name: "Coconut Crisp", price: 17.80 },
        { id: 117, name: "Salted Fish Crisp", price: 17.80 },
        { id: 118, name: "Salted Egg Crisp", price: 17.80 },
        { id: 119, name: "Cheese Crisp", price: 17.80 },
        { id: 120, name: "Chic Kut Teh", price: 18 },
        { id: 121, name: "Ginger Slice", price: 19.80 },
        { id: 122, name: "BH Dried Mango", price: 24.80 },
        { id: 123, name: "Kacang Tumbuk", price: 8.90 },
        { id: 124, name: "Gula Kacang", price: 8.90 },
        { id: 125, name: "Black Sesame Peanut", price: 13.80 },
        { id: 126, name: "Shat Kek Ma", price: 21.80 },
        { id: 127, name: "Shat Kek Ma (Brown Sugar)", price: 21.80 },
        { id: 128, name: "Coconut Biscuits (Beg)", price: 17.80 },
        { id: 129, name: "BH Freeze Dried Durian", price: 26.80 },
        { id: 130, name: "BH Freeze Dried Mango", price: 26.80 },
        { id: 131, name: "Butter Cookies", price: 16.80 },
        { id: 132, name: "Chocolate Cookies", price: 16.80 },
        { id: 133, name: "Raisin Cookies", price: 16.80 },
        { id: 134, name: "Almond Cookies", price: 16.80 },
        { id: 135, name: "Pineapple Tart", price: 0 },
        { id: 136, name: "Red Bean Mochi", price: 18.70 },
        { id: 137, name: "Peanut Mochi", price: 18.70 },
        { id: 138, name: "Green Tea Mochi", price: 18.70 },
        { id: 139, name: "Durian Mochi", price: 18.70 },
        { id: 140, name: "Yam Mochi", price: 18.70 },
        { id: 141, name: "Mochi Milk Yam Filling", price: 18.70 },
        { id: 142, name: "Mochi Milk Mango Filling", price: 18.70 },
        { id: 143, name: "Mochi Milk Green Tea", price: 18.70 },
        { id: 144, name: "Fillet Cracker With Anchovy", price: 14.60 },
        { id: 145, name: "Fillet Cracker With Seaweed", price: 14.60 },
        { id: 146, name: "Sakura Shrimp", price: 14.60 },
        { id: 147, name: "Frugurt Yogurt Blueberry", price: 24.80 },
        { id: 148, name: "Frugurt Yogurt Peach", price: 24.80 },
        { id: 149, name: "Frugurt Yogurt Mango", price: 24.80 },
        { id: 150, name: "Durian Pudding", price: 24.80 },
        { id: 151, name: "Coconut Pudding", price: 24.80 },
        { id: 152, name: "BH Dodol Durian", price: 0 },
        { id: 153, name: "BH Dodol Coconut", price: 0 },
        { id: 154, name: "BH Dodol Pandan", price: 0 },
        { id: 155, name: "Durian Beh Teh Saw", price: 28.90 },
    ],
    HopHup: [
        { id: 201, name: "Musang King Tart", price: 19 },
        { id: 202, name: "Mango Tart", price: 19 },
        { id: 203, name: "Durian Wafer Roll", price: 23.80 },
        { id: 204, name: "Omelette Durian", price: 25.80 },
        { id: 205, name: "HT Coconut Ori Cookies", price: 14.80 },
        { id: 206, name: "HT Coconut Pandan Cookies", price: 14.80 },
        { id: 207, name: "HT Dodol Kopi", price: 21.80 },
        { id: 208, name: "HT Dodol Durian", price: 21.80 },
        { id: 209, name: "HT Freeze Dried Mango", price: 26.80 },
        { id: 210, name: "HT Freeze Dried Durian", price: 26.80 },
        { id: 211, name: "Salted Egg Fish Skin", price: 30 },
        { id: 212, name: "Salted Egg Fish Skin Spicy", price: 30 },
        { id: 213, name: "Salted Egg Salmon Skin", price: 30 },
        { id: 214, name: "HT Musang King Durian Candy", price: 21.80 },
        { id: 215, name: "HT Dried Fruit Mango", price: 24.80 }
    ],
    Chocolate: [
        { id: 301, name: "AD Chocolate Durian", unit: 'pc', price: 39 },
        { id: 302, name: "AD Chocolate Sabah Tea", unit: 'pc', price: 39 },
        { id: 303, name: "AD Chocolate Mango", unit: 'pc', price: 39 },
        { id: 304, name: "AD Chocolate Chili", unit: 'pc', price: 39 },
        { id: 305, name: "AD Chocolate Dark", unit: 'pc', price: 39 },
        { id: 306, name: "AD Chocolate Coffee", unit: 'pc', price: 39 },
        { id: 307, name: "AD Chocolate Banana", unit: 'pc', price: 39 },
        { id: 308, name: "AD Chocolate Tiramisu", unit: 'pc', price: 39 },
        { id: 309, name: "AD Chocolate Mint", unit: 'pc', price: 39 },
        { id: 310, name: "AD Chocolate Rambutan", unit: 'pc', price: 39 },
        { id: 311, name: "AD Chocolate Soursup", unit: 'pc', price: 39 }
    ],
    Sotong: [
        { id: 401, name: "Cuttlefish Red", price: 21.50 },
        { id: 402, name: "Cuttlefish Lemon", price: 21.50 },
        { id: 403, name: "Cuttlefish Honey", price: 21.50 },
        { id: 404, name: "Cuttlefish Floss Original", price: 21.50 },
        { id: 405, name: "Cuttlefish Massive", price: 21.50 },
        { id: 406, name: "Cuttlefish Whole", price: 21.50 },
        { id: 407, name: "Cuttlefish Roasted", price: 21.50 },
        { id: 408, name: "Cuttlefish Chili", price: 21.50 },
        { id: 409, name: "Five Star Cuttlefish", price: 34.00 },
        { id: 410, name: "BH Sotong Cuttlefish", price: 14.60 },
        { id: 411, name: "BH Gula Cuttlefish", price: 14.60 },
        { id: 412, name: "BH Satay Fish", price: 14.60 }
    ],
    Coffee: [
        { id: 501, name: "BH W/Coffee(Mini)", price: 25.80 },
        { id: 502, name: "BH W/Coffee(Mini)No Sugar", price: 25.80 },
        { id: 503, name: "BH Durian W/Coffee(Mini)", price: 25.80 },
        { id: 504, name: "BH Teh Tarik(Mini)", price: 25.80 },
        { id: 505, name: "BH W/Coffee", price: 29.50 },
        { id: 506, name: "BH W/Coffee No Sugar", price: 29.50 },
        { id: 507, name: "BH Teh Tarik", price: 29.50 },
        { id: 508, name: "BH Durian White Coffee", price: 29.50 },
        { id: 509, name: "Kopi Tenom Silver", price: 11.70 },
        { id: 510, name: "Kopi Tenom Gold", price: 12.70 },
        { id: 511, name: "Kopi Tenom Blue", price: 14.80 },
        { id: 512, name: "Kopi Tenom Green", price: 14.30 },
        { id: 513, name: "Kopi Tenom Red ", price: 15.60 }
    ],
    Amplang: [
        { id: 601, name: "Amplang Ikan", price: 12 },
        { id: 602, name: "Amplang Udang", price: 12 },
        { id: 603, name: "Amplang Sotong", price: 12 },
        { id: 604, name: "kuih Cincin", price: 12 },
        { id: 605, name: "Kuih Cincin (Mini)", price: 18 }
    ],
    SabahTea: [
        { id: 701, name: "Sabah Tea (S)", price: 7.50 },
        { id: 702, name: "Sabah Tea (B)", price: 14 },
        { id: 703, name: "Sabah Tea Box", price: 40 },
        { id: 704, name: "Sabah Tea Gift Box", price: 96 },
        { id: 705, name: "Sabah Tea Agarwood", price: 15.80 },
        { id: 706, name: "Sabah Tea Cinnamon", price: 15.80 },
        { id: 707, name: "Sabah Tea Ginger", price: 15.80 },
        { id: 708, name: "Sabah Tea Misai Kuching", price: 15.80 },
        { id: 709, name: "Sabah Tea Tongat Ali", price: 15.80 },
        { id: 710, name: "Sabah Tea Geranium", price: 15.80 },
        { id: 711, name: "Sabah Tea Lemon Grass", price: 15.80 },
        { id: 712, name: "Sabah Tea Pandan", price: 15.80 },
        { id: 713, name: "Sabah Tea Organic", price: 20 },
        { id: 714, name: "Sabah Tea Wooden box (B)", price: 65 },
        { id: 715, name: "Sabah Tea Wooden box (S)", price: 47.70 }
    ],
    Other: [
        { id: 801, name: "Fruity Gummy Assorted", price: 8.50 },
        { id: 802, name: "Fruity Gummy Mango", price: 8.50 },
        { id: 803, name: "Durian Kuih", price: 33 },
        { id: 804, name: "Anchovy Blue", price: 28.80 },
        { id: 805, name: "Anchovy Green", price: 28.80 },
        { id: 806, name: "Anchovy Red", price: 19.80 },
        { id: 807, name: "Anchovy Yellow", price: 19.80 },
        { id: 808, name: "Bird Nest", price: 0, customPrice: true },
        { id: 809, name: "Fish Maw", price: 0, customPrice: true },
        { id: 810, name: "Sea Cucumber", price: 0, customPrice: true }
    ],
 Drink: [
        { id: 901, name: "Spritzer 550ml", price: 3.50 },
        { id: 902, name: "Spritzer 750ml", price: 6.00 },
        { id: 903, name: "Spritzer 250ml", price: 2.50 },
        { id: 904, name: "SASA 550ml", price: 2, }
    ]

        };
        let selectedItems = {};
        let billNumber = 1; // ÂçïÊçÆÁºñÂè∑
        let selectedStore = ""; // ‰øùÂ≠òÈÄâ‰∏≠ÁöÑÂ∫óÈì∫ÂêçÁß∞
        let supervisorName = "";
        let cashierName = "";

        window.onload = function () {
            const categoryContainer = document.getElementById("categoryContainer");
            for (let category in categories) {
                const label = document.createElement("label");
                label.innerHTML = `<input type="radio" name="category" value="${category}" onclick="showCategory()">${category}`;
                categoryContainer.appendChild(label);
            }

            // ÂºÄÂßãÊó∂ÊòæÁ§∫ËæìÂÖ• Supervisor Âíå Cashier ÁöÑÂºπÁ™ó
            showSupervisorAndCashierModal();

            // Âä®ÊÄÅÂä†ËΩΩÂ∫óÈì∫ÂàóË°®Âà∞‰∏ãÊãâËèúÂçïÔºàÂ¶ÇÊûúÈúÄË¶ÅÔºâ
            // ‰æãÂ¶ÇÔºå‰ªé Firebase Ëé∑ÂèñÂ∫óÈì∫ÂàóË°®Âπ∂Â°´ÂÖÖ‰∏ãÊãâËèúÂçï
        };

        function showSupervisorAndCashierModal() {
            const modal = document.getElementById("supervisorModal");
            modal.style.display = "block"; // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
        }

        function submitSupervisorAndCashier() {
            const supervisorInput = document.getElementById("supervisorInput").value.trim();
            const cashierInput = document.getElementById("cashierInput").value.trim();

            if (!supervisorInput || !cashierInput) {
                alert("Both Supervisor and Cashier names are required!");
                return;
            }

            supervisorName = supervisorInput;
            cashierName = cashierInput;

            // ÈöêËóèÊ®°ÊÄÅÊ°Ü
            const modal = document.getElementById("supervisorModal");
            modal.style.display = "none";

            // ÊòæÁ§∫Â∫óÈì∫ÈÄâÊã©Ê®°ÊÄÅÊ°Ü
            showStoreSelectionModal();
        }

        function showStoreSelectionModal() {
            const modal = document.getElementById("storeModal");
            modal.style.display = "block"; // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
        }

        function selectStore(storeName) {
            selectedStore = storeName;

            // ÈöêËóèÊ®°ÊÄÅÊ°Ü
            const modal = document.getElementById("storeModal");
            modal.style.display = "none";

            alert(`Store "${storeName}" selected successfully.`);
            resetAllData(); // ÈáçÁΩÆÊï∞ÊçÆ
            updateCurrentBillDisplay();
        }

        function resetAllData() {
            billNumber = 1;
            selectedItems = {};

            // Reset the display
            alert(`All previous data has been reset. Starting fresh from Bill 001.`);
        }

        function loadProducts(products) {
            const productList = document.getElementById('productList');
            productList.innerHTML = '';

            products.forEach(product => {
                const div = document.createElement('div');
                if (product.customPrice) {
                    div.innerHTML = `
                        <label>${product.name}</label>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <input type="number" 
                                   id="price${product.id}" 
                                   placeholder="Enter price" 
                                   style="width: 100px; padding: 5px; background-color: white; color: black;"
                                   step="0.10">
                            <button onclick="addCustomItem(${product.id}, '${product.name}')">Add</button>
                            <span onclick="removeItem('${product.id}-custom')" style="cursor: pointer;">‚ùå</span>
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <input type="checkbox" id="item${product.id}" onchange="saveItem(${product.id}, '${product.name}', ${product.price})">
                        <label for="item${product.id}">${product.name} - RM${product.price.toFixed(2)}</label>
                        <div style="display: flex; align-items: center;">
                            <button onclick="decreaseQuantity(${product.id})">-</button>
                            <span id="quantityDisplay${product.id}" style="padding: 0 10px;">1</span>
                            <button onclick="increaseQuantity(${product.id})">+</button>
                            <span onclick="removeItem(${product.id})" style="cursor: pointer;">‚ùå</span>
                        </div>
                    `;
                }
                productList.appendChild(div);
            });
        }

        function removeItem(uniqueId) {
            const checkbox = document.getElementById('item' + uniqueId);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.onchange(); // Ëß¶Âèë‰øùÂ≠òÊìç‰ΩúÔºåÁßªÈô§ÂïÜÂìÅ
            } else {
                // Â¶ÇÊûúÊòØËá™ÂÆö‰πâÂïÜÂìÅÔºåÁõ¥Êé•‰ªé selectedItems ‰∏≠Âà†Èô§
                delete selectedItems[uniqueId];
            }
            updateResult();
        }

        function increaseQuantity(id) {
            const quantityDisplay = document.getElementById(`quantityDisplay${id}`);
            let currentQuantity = parseInt(quantityDisplay.textContent);
            currentQuantity++;
            quantityDisplay.textContent = currentQuantity;
            saveQuantity(id, currentQuantity);  // Êõ¥Êñ∞ÈÄâ‰∏≠ÁöÑÂïÜÂìÅÊï∞Èáè
            updateResult();
        }

        function decreaseQuantity(id) {
            const quantityDisplay = document.getElementById(`quantityDisplay${id}`);
            let currentQuantity = parseInt(quantityDisplay.textContent);
            if (currentQuantity > 1) {  // Á°Æ‰øùÊï∞Èáè‰∏çÂ∞è‰∫é 1
                currentQuantity--;
                quantityDisplay.textContent = currentQuantity;
                saveQuantity(id, currentQuantity);  // Êõ¥Êñ∞ÈÄâ‰∏≠ÁöÑÂïÜÂìÅÊï∞Èáè
                updateResult();
            }
        }

        function searchItems() {
            const searchTerm = document.getElementById('searchBar').value.toLowerCase();
            const allProducts = Object.values(categories).flat();
            const filteredProducts = allProducts.filter(product => product.name.toLowerCase().includes(searchTerm));

            // Ê∏ÖÁ©∫Âª∫ËÆÆÂàóË°®
            const suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';

            // Â¶ÇÊûúÊêúÁ¥¢Ê†è‰∏∫Á©∫Ôºå‰∏çÊòæÁ§∫Âª∫ËÆÆ
            if (searchTerm === '') {
                return;
            }

            // ÊòæÁ§∫Âª∫ËÆÆÂàóË°®
            filteredProducts.forEach(product => {
                const suggestionItem = document.createElement('div');
                suggestionItem.textContent = product.name;
                suggestionItem.onclick = function () {
                    document.getElementById('searchBar').value = product.name;
                    suggestionsDiv.innerHTML = '';  // Ê∏ÖÁ©∫Âª∫ËÆÆÂàóË°®
                    loadProducts([product]);  // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑ‰∫ßÂìÅ‰ø°ÊÅØ
                };
                suggestionsDiv.appendChild(suggestionItem);
            });
        }

        function saveItem(id, name, price) {
            const checkbox = document.getElementById("item" + id);
            const quantity = parseInt(document.getElementById("quantityDisplay" + id).textContent) || 1;

            if (checkbox.checked) {
                selectedItems[id] = { name: name, quantity: quantity, price: price };
            } else {
                delete selectedItems[id];
            }

            // Â¶ÇÊûúËá≥Â∞ëÊúâ‰∏Ä‰∏™ÂïÜÂìÅË¢´ÈÄâÊã©ÔºåÊòæÁ§∫ÊîØ‰ªòÊñπÂºè
            if (Object.keys(selectedItems).length > 0) {
                togglePaymentMethod(true);
            } else {
                togglePaymentMethod(false);
            }

            updateResult();
        }

        function saveQuantity(id, quantity) {
            if (selectedItems[id]) {
                selectedItems[id].quantity = quantity;
            }
        }

        function toggleItems() {
            let checkboxes = document.querySelectorAll('#productList input[type="checkbox"]');
            let quantities = document.querySelectorAll('#productList input[type="number"]');

            checkboxes.forEach((checkbox) => (checkbox.disabled = false));
            quantities.forEach((quantity) => (quantity.disabled = false));
        }

        function showCategory() {
            let selectedCategory = document.querySelector('input[name="category"]:checked');

            if (selectedCategory) {
                let categoryValue = selectedCategory.value;
                let productsToShow = categories[categoryValue];

                if (productsToShow) {
                    loadProducts(productsToShow);
                } else {
                    console.error("Ê≤°ÊúâÊâæÂà∞ËØ•ÂàÜÁ±ªÁöÑÂïÜÂìÅ");
                }
            } else {
                console.error("Ê≤°ÊúâÈÄâ‰∏≠‰ªª‰ΩïÂàÜÁ±ª");
            }

            toggleItems();
        }

        function calculateTotal() {
            let total = 0;
            for (const item of Object.values(selectedItems)) {
                total += item.quantity * item.price;
            }
            return total.toFixed(2);
        }

        function updateResult() {
            let result = `Store: ${selectedStore}\n`;
            result += `Supervisor: ${supervisorName}\n`;
            result += `Cashier: ${cashierName}\n\n`;

            const formattedBillNumber = billNumber.toString().padStart(3, "0");
            result += `Bill No: ${formattedBillNumber}\n`;

            let selectedPaymentMethod = document.querySelector('input[name="store"]:checked');
            if (selectedPaymentMethod) {
                result += "Payment: " + selectedPaymentMethod.value + "\n\n";
            } else {
                result += "Payment: No Select\n";
            }

            for (const itemId in selectedItems) {
                const item = selectedItems[itemId];
                result += `${item.name} - ${item.quantity} pc, RM${(item.quantity * item.price).toFixed(2)}\n`;
            }

            result += `\nTotal: RM${calculateTotal()}\n`;

            const currentDate = new Date();
            const dateString = currentDate.toLocaleDateString();
            const timeString = currentDate.toLocaleTimeString();
            result += `\nDate: ${dateString}\nTime: ${timeString}`;

            document.getElementById("result").innerText = result;
        }

        function clearAll() {
            // Ê£ÄÊü•ÊòØÂê¶ÊúâÂïÜÂìÅ
            if (Object.keys(selectedItems).length === 0) {
                alert("Please add at least one product before proceeding to the next bill.");
                return;
            }

            // Ê£ÄÊü•ÊîØ‰ªòÊñπÂºè
            const selectedPaymentMethod = document.querySelector('input[name="store"]:checked');
            if (!selectedPaymentMethod) {
                alert("Please select a payment method before proceeding.");
                return;
            }

            const total = parseFloat(calculateTotal());

            // Â¶ÇÊûúÈÄâÊã©‰∫Ü CashÔºåÈúÄË¶ÅÁ°Æ‰øùËæìÂÖ•‰∫ÜÁé∞ÈáëÈáëÈ¢ù
            if (selectedPaymentMethod.value === "Cash") {
                const cashAmount = parseFloat(document.getElementById("cashAmount").value);

                if (isNaN(cashAmount) || cashAmount < total) {
                    alert("Please enter a valid cash amount that is equal to or greater than the total amount.");
                    return;
                }

                // Update change
                const change = cashAmount - total;
                if (change >= 0) {
                    document.getElementById("changeAmount").textContent = `Change: RM${change.toFixed(2)}`;
                } else {
                    document.getElementById("changeAmount").textContent = `Insufficient amount`;
                    return;
                }
            }

            // Save the bill
            saveBill();
        }

        function toggleDarkMode() {
            const isDarkModeEnabled = document.body.classList.toggle('dark-mode');
            const toggleButton = document.querySelector('.toggle-mode-btn');

            if (isDarkModeEnabled) {
                toggleButton.textContent = 'ÂàáÊç¢Ëá≥Ê≠£Â∏∏Ê®°Âºè';
                localStorage.setItem('dark-mode', 'enabled');
            } else {
                toggleButton.textContent = 'ÂàáÊç¢Ëá≥ÈªëÊöóÊ®°Âºè';
                localStorage.setItem('dark-mode', 'disabled');
            }
        }

        function toggleCashInput() {
            document.getElementById("cashInputContainer").style.display = "block";
            calculateChange();
        }

        function hideCashInput() {
            document.getElementById("cashInputContainer").style.display = "none";
            document.getElementById("changeAmount").textContent = "";
        }

        function calculateChange() {
            const cashAmount = parseFloat(document.getElementById("cashAmount").value) || 0;
            const total = parseFloat(calculateTotal());
            const change = cashAmount - total;

            if (!isNaN(change) && change >= 0) {
                document.getElementById("changeAmount").textContent = `Change: RM${change.toFixed(2)}`;
            } else if (!isNaN(change) && change < 0) {
                document.getElementById("changeAmount").textContent = `Insufficient amount`;
            } else {
                document.getElementById("changeAmount").textContent = "";
            }

            updateResult();
        }

        function selectPayment(radio) {
            // ÁßªÈô§ÊâÄÊúâÊîØ‰ªòÈÄâÈ°πÁöÑÈÄâ‰∏≠Ê†∑Âºè
            document.querySelectorAll(".payment-option").forEach((option) => {
                option.classList.remove("selected");
            });

            // ‰∏∫ÈÄâ‰∏≠ÁöÑÊîØ‰ªòÈÄâÈ°πÊ∑ªÂä†Ê†∑Âºè
            if (radio.checked) {
                radio.closest(".payment-option").classList.add("selected");
            }
        }

        function addCustomItem(id, name) {
            const priceInput = document.getElementById('price' + id);
            const price = parseFloat(priceInput.value);

            if (isNaN(price) || price <= 0) {
                alert('Please enter a valid price');
                return;
            }

            // ÁîüÊàêÂîØ‰∏ÄÁöÑ IDÔºåÈÅøÂÖçÈáçÂ§ç
            const uniqueId = `${id}-custom-${Date.now()}`;

            // Ê∑ªÂä†Âà∞ selectedItemsÔºåÁ°Æ‰øùÊØèÊ¨°ÈÉΩÊòØÊñ∞ËÆ∞ÂΩï
            selectedItems[uniqueId] = { name: name, quantity: 1, price: price };

            updateResult();

            // Âú®È°µÈù¢‰∏äÊòæÁ§∫ÊàêÂäü‰ø°ÊÅØ
            const successMessage = document.createElement('div');
            successMessage.textContent = `${name} added successfully!`;
            successMessage.style.color = 'green';
            document.body.appendChild(successMessage);
            setTimeout(() => successMessage.remove(), 3000); // 3ÁßíÂêéËá™Âä®ÁßªÈô§ÊèêÁ§∫‰ø°ÊÅØ

            // Ê∏ÖÁ©∫‰ª∑Ê†ºËæìÂÖ•Ê°Ü
            priceInput.value = '';
        }

        function saveBill() {
            if (!selectedStore) {
                alert("Please select a store before saving the bill.");
                return;
            }

            const formattedBillNumber = billNumber.toString().padStart(3, "0"); // Ê†ºÂºèÂåñ‰∏∫‰∏â‰ΩçÊï∞ÔºåÂ¶Ç 001, 002

            // ÂàõÂª∫ÂçïÊçÆÂØπË±°
            const billData = {
                billNumber: formattedBillNumber,
                store: selectedStore,
                supervisor: supervisorName,
                cashier: cashierName,
                paymentMethod: document.querySelector('input[name="store"]:checked') ? document.querySelector('input[name="store"]:checked').value : "No Select",
                items: selectedItems,
                total: parseFloat(calculateTotal()),
                date: new Date().toISOString()
            };

            // Â∞ÜÂçïÊçÆÂ≠òÂÇ®Âà∞ Realtime Database ÁöÑ "stores/{store}/bills/{billNumber}" ËäÇÁÇπ‰∏≠
            database.ref(`stores/${selectedStore}/bills/${formattedBillNumber}`).set(billData, function (error) {
                if (error) {
                    console.error("Error saving bill: ", error);
                    alert("‰øùÂ≠òÂçïÊçÆÊó∂Âá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
                } else {
                    // Êõ¥Êñ∞ÈîÄÂîÆÁªüËÆ°Êï∞ÊçÆ
                    updateSalesSummary(selectedStore, billData);

                    // Êõ¥Êñ∞ÂçïÊçÆÁºñÂè∑
                    billNumber++;
                    updateCurrentBillDisplay();

                    alert(`Bill ${formattedBillNumber} saved successfully!`);

                    // Clear selections for next customer
                    selectedItems = {};
                    document.getElementById("productList").innerHTML = "";
                    document.getElementById("result").innerText = "";
                    document.querySelectorAll('input[name="store"]').forEach((input) => (input.checked = false));
                    document.querySelectorAll('input[name="category"]').forEach((input) => (input.checked = false));
                    togglePaymentMethod(false); // ÈöêËóèÊîØ‰ªòÊñπÂºè
                    hideCashInput(); // ÈöêËóèÁé∞ÈáëËæìÂÖ•Ê°Ü
                    toggleItems();
                }
            });
        }

        function updateSalesSummary(store, billData) {
            const paymentMethod = billData.paymentMethod; // "Cash", "Card", "E-Wallet"
            const total = billData.total;

            // Update salesSummary for the specific store
            const salesSummaryRef = database.ref(`stores/${store}/salesSummary`);
            salesSummaryRef.once('value', function (snapshot) {
                let currentData = snapshot.val();
                if (!currentData) {
                    currentData = { cash: 0, card: 0, ewallet: 0 };
                }

                if (paymentMethod === "Cash") {
                    currentData.cash += total;
                } else if (paymentMethod === "Card") {
                    currentData.card += total;
                } else if (paymentMethod === "E-Wallet") {
                    currentData.ewallet += total;
                }

                // Save updated salesSummary back to database
                salesSummaryRef.set(currentData, function (error) {
                    if (error) {
                        console.error("Error updating sales summary: ", error);
                    } else {
                        console.log("Sales summary updated successfully.");
                    }
                });
            }, function (error) {
                console.error("Error fetching sales summary: ", error);
            });

            // Update soldItems for the specific store
            const soldItemsRef = database.ref(`stores/${store}/soldItems`);
            for (const itemId in billData.items) {
                const item = billData.items[itemId];
                const itemNameKey = item.name.replace(/\s+/g, '_'); // Use underscore instead of spaces

                soldItemsRef.child(itemNameKey).once('value', function (snapshot) {
                    let currentItemData = snapshot.val();
                    if (!currentItemData) {
                        currentItemData = { quantity: 0, totalPrice: 0 };
                    }

                    currentItemData.quantity += item.quantity;
                    currentItemData.totalPrice += item.quantity * item.price;

                    // Save updated item data back to database
                    soldItemsRef.child(itemNameKey).set(currentItemData, function (error) {
                        if (error) {
                            console.error(`Error updating sold item ${item.name}: `, error);
                        } else {
                            console.log(`Sold item ${item.name} updated successfully.`);
                        }
                    });
                }, function (error) {
                    console.error(`Error fetching sold item ${item.name}: `, error);
                });
            }
        }

        function updateCurrentBillDisplay() {
            const formattedBillNumber = billNumber.toString().padStart(3, "0");
            document.getElementById("currentBillDisplay").textContent = `Current Bill: ${formattedBillNumber}`;
        }

        function searchBill(billInput) {
            const billKey = billInput.padStart(3, "0"); // Ensure it's three digits

            if (!selectedStore) {
                alert("Please select a store before searching for bills.");
                return;
            }

            database.ref(`stores/${selectedStore}/bills/${billKey}`).once('value', function (snapshot) {
                if (snapshot.exists()) {
                    const billData = snapshot.val();
                    const billText = `
Store: ${billData.store}
Supervisor: ${billData.supervisor}
Cashier: ${billData.cashier}

Bill No: ${billData.billNumber}
Payment: ${billData.paymentMethod}

${Object.values(billData.items).map(item => `${item.name} - ${item.quantity} pc, RM${(item.quantity * item.price).toFixed(2)}`).join('\n')}

Total: RM${billData.total.toFixed(2)}

Date: ${new Date(billData.date).toLocaleDateString()}
Time: ${new Date(billData.date).toLocaleTimeString()}
                `;
                    showModal(billText, billKey);
                } else {
                    alert(`Bill ${billInput} not found.`);
                }
            }, function (error) {
                console.error("Error fetching bill: ", error);
                alert("Êü•ËØ¢ÂçïÊçÆÊó∂Âá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
            });
        }

        function showModal(data, currentBill) {
            // ÂàõÂª∫‰∏Ä‰∏™Ê®°ÊÄÅÊ°Ü
            const modal = document.createElement("div");
            modal.id = "modalContainer";
            modal.classList.add("modal");

            // Ê∑ªÂä†ÂçïÊçÆÂÜÖÂÆπ
            const content = document.createElement("pre");
            content.style.color = "black";
            content.style.margin = "0";
            content.style.whiteSpace = "pre-wrap"; // Ëá™Âä®Êç¢Ë°å
            content.textContent = data;
            modal.appendChild(content);

            // Ê∑ªÂä†ÊåâÈíÆÂÆπÂô®
            const buttonContainer = document.createElement("div");
            buttonContainer.style.display = "flex";
            buttonContainer.style.justifyContent = "space-between";
            buttonContainer.style.marginTop = "20px";

            // Ê∑ªÂä†"Ââç‰∏ÄÂº†"ÊåâÈíÆ
            const prevButton = document.createElement("button");
            prevButton.textContent = "Previous Bill";
            prevButton.style.backgroundColor = "#007bff";
            prevButton.style.color = "white";
            prevButton.style.padding = "10px";
            prevButton.style.border = "none";
            prevButton.style.borderRadius = "5px";
            prevButton.style.cursor = "pointer";
            prevButton.onclick = function () {
                const prevBillNumber = parseInt(currentBill) - 1;
                if (prevBillNumber < 1) {
                    alert("No previous bill found.");
                    return;
                }
                const prevBillKey = prevBillNumber.toString().padStart(3, "0");
                database.ref(`stores/${selectedStore}/bills/${prevBillKey}`).once('value', function (prevSnapshot) {
                    if (prevSnapshot.exists()) {
                        document.body.removeChild(modal); // ÂÖ≥Èó≠ÂΩìÂâçÊ®°ÊÄÅÊ°Ü
                        const prevBillData = prevSnapshot.val();
                        const prevBillText = `
Store: ${prevBillData.store}
Supervisor: ${prevBillData.supervisor}
Cashier: ${prevBillData.cashier}

Bill No: ${prevBillData.billNumber}
Payment: ${prevBillData.paymentMethod}

${Object.values(prevBillData.items).map(item => `${item.name} - ${item.quantity} pc, RM${(item.quantity * item.price).toFixed(2)}`).join('\n')}

Total: RM${prevBillData.total.toFixed(2)}

Date: ${new Date(prevBillData.date).toLocaleDateString()}
Time: ${new Date(prevBillData.date).toLocaleTimeString()}
                        `;
                        showModal(prevBillText, prevBillKey);
                    } else {
                        alert("No previous bill found.");
                    }
                }, function (error) {
                    console.error("Error fetching previous bill: ", error);
                    alert("Êü•ËØ¢Ââç‰∏ÄÂº†ÂçïÊçÆÊó∂Âá∫Èîô„ÄÇ");
                });
            };
            buttonContainer.appendChild(prevButton);

            // Ê∑ªÂä†"Âêé‰∏ÄÂº†"ÊåâÈíÆ
            const nextButton = document.createElement("button");
            nextButton.textContent = "Next Bill";
            nextButton.style.backgroundColor = "#007bff";
            nextButton.style.color = "white";
            nextButton.style.padding = "10px";
            nextButton.style.border = "none";
            nextButton.style.borderRadius = "5px";
            nextButton.style.cursor = "pointer";
            nextButton.onclick = function () {
                const nextBillNumber = parseInt(currentBill) + 1;
                const nextBillKey = nextBillNumber.toString().padStart(3, "0");
                database.ref(`stores/${selectedStore}/bills/${nextBillKey}`).once('value', function (nextSnapshot) {
                    if (nextSnapshot.exists()) {
                        document.body.removeChild(modal); // ÂÖ≥Èó≠ÂΩìÂâçÊ®°ÊÄÅÊ°Ü
                        const nextBillData = nextSnapshot.val();
                        const nextBillText = `
Store: ${nextBillData.store}
Supervisor: ${nextBillData.supervisor}
Cashier: ${nextBillData.cashier}

Bill No: ${nextBillData.billNumber}
Payment: ${nextBillData.paymentMethod}

${Object.values(nextBillData.items).map(item => `${item.name} - ${item.quantity} pc, RM${(item.quantity * item.price).toFixed(2)}`).join('\n')}

Total: RM${nextBillData.total.toFixed(2)}

Date: ${new Date(nextBillData.date).toLocaleDateString()}
Time: ${new Date(nextBillData.date).toLocaleTimeString()}
                        `;
                        showModal(nextBillText, nextBillKey);
                    } else {
                        alert("No next bill found.");
                    }
                }, function (error) {
                    console.error("Error fetching next bill: ", error);
                    alert("Êü•ËØ¢Âêé‰∏ÄÂº†ÂçïÊçÆÊó∂Âá∫Èîô„ÄÇ");
                });
            };
            buttonContainer.appendChild(nextButton);

            modal.appendChild(buttonContainer);

            // Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ
            const closeButton = document.createElement("button");
            closeButton.textContent = "Close";
            closeButton.classList.add("close-button");
            closeButton.onclick = function () {
                document.body.removeChild(modal);
            };

            modal.appendChild(closeButton);

            // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞ body
            document.body.appendChild(modal);
            modal.style.display = "block";
        }

        function deleteBill() {
            const billInput = document.getElementById("billSearchInput").value.trim();
            if (billInput === "") {
                alert("Please enter a valid bill number.");
                return;
            }

            const billKey = billInput.padStart(3, "0"); // Á°Æ‰øùÊòØ‰∏â‰ΩçÊï∞ÔºåÂ¶Ç 001

            if (!selectedStore) {
                alert("Please select a store before deleting bills.");
                return;
            }

            const billRef = database.ref(`stores/${selectedStore}/bills/${billKey}`);

            billRef.once('value', function (snapshot) {
                if (snapshot.exists()) {
                    const billData = snapshot.val();

                    const confirmDelete = confirm(`Are you sure you want to delete bill ${billInput}?`);
                    if (confirmDelete) {
                        // ÂÖàÊõ¥Êñ∞ salesSummary Âíå soldItems
                        const paymentMethod = billData.paymentMethod;
                        const total = billData.total;
                        const items = billData.items;

                        // Êõ¥Êñ∞ salesSummary
                        const salesSummaryRef = database.ref(`stores/${selectedStore}/salesSummary`);
                        salesSummaryRef.once('value', function (summarySnapshot) {
                            let summaryData = summarySnapshot.val();
                            if (!summaryData) {
                                summaryData = { cash: 0, card: 0, ewallet: 0 };
                            }

                            if (paymentMethod === "Cash") {
                                summaryData.cash -= total;
                                if (summaryData.cash < 0) summaryData.cash = 0; // Èò≤Ê≠¢Ë¥üÊï∞
                            } else if (paymentMethod === "Card") {
                                summaryData.card -= total;
                                if (summaryData.card < 0) summaryData.card = 0;
                            } else if (paymentMethod === "E-Wallet") {
                                summaryData.ewallet -= total;
                                if (summaryData.ewallet < 0) summaryData.ewallet = 0;
                            }

                            // Êõ¥Êñ∞ salesSummary
                            salesSummaryRef.set(summaryData, function (error) {
                                if (error) {
                                    console.error("Error updating sales summary: ", error);
                                    alert("Âà†Èô§ÂçïÊçÆÊó∂Êõ¥Êñ∞ÈîÄÂîÆÊëòË¶ÅÂá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
                                    return;
                                }

                                // Êõ¥Êñ∞ soldItems
                                const soldItemsRef = database.ref(`stores/${selectedStore}/soldItems`);
                                const updateSoldItemsPromises = [];

                                for (const itemId in items) {
                                    const item = items[itemId];
                                    const itemNameKey = item.name.replace(/\s+/g, '_'); // Áî®‰∏ãÂàíÁ∫øÊõø‰ª£Á©∫Ê†º

                                    const itemRef = soldItemsRef.child(itemNameKey);
                                    const promise = itemRef.once('value').then(function (itemSnapshot) {
                                        if (itemSnapshot.exists()) {
                                            const currentItemData = itemSnapshot.val();
                                            currentItemData.quantity -= item.quantity;
                                            currentItemData.totalPrice -= item.quantity * item.price;

                                            // Á°Æ‰øù‰∏ç‰ºöÂá∫Áé∞Ë¥üÊï∞
                                            if (currentItemData.quantity < 0) currentItemData.quantity = 0;
                                            if (currentItemData.totalPrice < 0) currentItemData.totalPrice = 0;

                                            // Â¶ÇÊûúÂïÜÂìÅÊï∞ÈáèÂíåÊÄª‰ª∑ÈÉΩ‰∏∫Èõ∂ÔºåÂàôÂà†Èô§ËØ•ÂïÜÂìÅËÆ∞ÂΩï
                                            if (currentItemData.quantity === 0 && currentItemData.totalPrice === 0) {
                                                return itemRef.remove();
                                            } else {
                                                return itemRef.set(currentItemData);
                                            }
                                        }
                                    }).catch(function (error) {
                                        console.error(`Error updating sold item ${item.name}: `, error);
                                    });

                                    updateSoldItemsPromises.push(promise);
                                }

                                // Á≠âÂæÖÊâÄÊúâ soldItems Êõ¥Êñ∞ÂÆåÊàê
                                Promise.all(updateSoldItemsPromises).then(function () {
                                    // ÊúÄÂêéÂà†Èô§ÂçïÊçÆ
                                    billRef.remove(function (error) {
                                        if (error) {
                                            console.error("Error deleting bill: ", error);
                                            alert("Âà†Èô§ÂçïÊçÆÊó∂Âá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
                                        } else {
                                            alert(`Bill ${billInput} deleted successfully.`);

                                            // Â¶ÇÊûúÂΩìÂâçÊòæÁ§∫ÁöÑÂçïÊçÆÊòØË¢´Âà†Èô§ÁöÑÂçïÊçÆÔºåÂèØ‰ª•Ê∏ÖÈô§ÊòæÁ§∫
                                            document.getElementById("result").innerText = "";
                                            document.getElementById("productList").innerHTML = "";
                                            selectedItems = {};
                                            togglePaymentMethod(false);
                                            hideCashInput();
                                            toggleItems();
                                            updateCurrentBillDisplay(); // ÂèØÈÄâÔºöÊõ¥Êñ∞ÂΩìÂâçÂçïÊçÆÊòæÁ§∫
                                        }
                                    });
                                });
                            });
                        }, function (error) {
                            console.error("Error fetching sales summary: ", error);
                            alert("Âà†Èô§ÂçïÊçÆÊó∂Ëé∑ÂèñÈîÄÂîÆÊëòË¶ÅÂá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
                        });
                    }
                } else {
                    alert(`Bill ${billInput} not found.`);
                }
            }, function (error) {
                console.error("Error fetching bill: ", error);
                alert("Êü•ËØ¢ÂçïÊçÆÊó∂Âá∫ÈîôÔºåËØ∑Á®çÂêéÈáçËØï„ÄÇ");
            });
        }

        function togglePaymentMethod(show) {
            const paymentSection = document.querySelector(".payment-section");
            if (show) {
                paymentSection.style.display = "block"; // ÊòæÁ§∫ÊîØ‰ªòÊñπÂºè
            } else {
                paymentSection.style.display = "none"; // ÈöêËóèÊîØ‰ªòÊñπÂºè
            }
        }

        function showSalesClosing() {
            if (!selectedStore) {
                alert("Please select a store before viewing sales closing.");
                return;
            }

            const salesSummaryRef = database.ref(`stores/${selectedStore}/salesSummary`);
            const soldItemsRef = database.ref(`stores/${selectedStore}/soldItems`);

            // Fetch sales summary
            salesSummaryRef.once('value', function (summarySnapshot) {
                const summaryData = summarySnapshot.val() || { cash: 0, card: 0, ewallet: 0 };
                const totalSales = summaryData.cash + summaryData.card + summaryData.ewallet;

                // Fetch sold items
                soldItemsRef.orderByChild('quantity').once('value', function (itemsSnapshot) {
                    const itemsData = itemsSnapshot.val() || {};
                    // Convert to array and sort by quantity descending
                    const sortedItems = Object.entries(itemsData).sort((a, b) => b[1].quantity - a[1].quantity);

                    // Create modal content
                    const modal = document.createElement("div");
                    modal.classList.add("modal");

                    const content = document.createElement("div");
                    content.style.color = "black";

                    // ÂïÜÂìÅÊéíÂ∫èÔºöÊåâË¥≠‰π∞Êï∞ÈáèÈôçÂ∫è
                    let itemDetails = "";
                    sortedItems.forEach(([itemName, item]) => {
                        itemDetails += `<p>${itemName.replace(/_/g, ' ')} - Quantity: ${item.quantity}, Total: RM${item.totalPrice.toFixed(2)}</p>`;
                    });

                    content.innerHTML = `
                        <h3>Sales Closing</h3>
                        <p><strong>Store:</strong> ${selectedStore}</p>
                        <p><strong>Supervisor:</strong> ${supervisorName}</p>
                        <p><strong>Cashier:</strong> ${cashierName}</p>
                        <p><strong>Cash:</strong> RM${summaryData.cash.toFixed(2)}</p>
                        <p><strong>Card:</strong> RM${summaryData.card.toFixed(2)}</p>
                        <p><strong>E-Wallet:</strong> RM${summaryData.ewallet.toFixed(2)}</p>
                        <p><strong>Total Sales:</strong> RM${totalSales.toFixed(2)}</p>
                        <h4>Sold Items (Sorted by Quantity):</h4>
                        ${itemDetails}
                    `;
                    modal.appendChild(content);

                    // Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ
                    const closeButton = document.createElement("button");
                    closeButton.textContent = "Close";
                    closeButton.classList.add("close-button");
                    closeButton.onclick = function () {
                        document.body.removeChild(modal);
                    };
                    modal.appendChild(closeButton);

                    // Ê∑ªÂä†Ê®°ÊÄÅÊ°ÜÂà∞ body
                    document.body.appendChild(modal);
                    modal.style.display = "block";
                }, function (error) {
                    console.error("Error fetching sold items: ", error);
                    alert("Ëé∑ÂèñÂîÆÂá∫Áâ©ÂìÅÊï∞ÊçÆÊó∂Âá∫Èîô„ÄÇ");
                });
            }, function (error) {
                console.error("Error fetching sales summary: ", error);
                alert("Ëé∑ÂèñÈîÄÂîÆÊëòË¶ÅÊï∞ÊçÆÊó∂Âá∫Èîô„ÄÇ");
            });
        }
    </script>
    <p class="contact-info">If you have any questions or need to add new products, please contact me (Mark).</p>

    <!-- Supervisor Âíå Cashier ËæìÂÖ•Ê®°ÊÄÅÊ°Ü -->
    <div id="supervisorModal" class="modal">
        <h3 style="text-align: center; color: black;">Enter Supervisor and Cashier</h3>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px;">
            <input id="supervisorInput" type="text" placeholder="Supervisor Name" style="width: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;">
            <input id="cashierInput" type="text" placeholder="Cashier Name" style="width: 200px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; font-size: 16px;">
            <button onclick="submitSupervisorAndCashier()" style="width: 200px; height: 50px; font-size: 16px; background-color: black; color: white; border: none; border-radius: 5px; cursor: pointer;">Submit</button>
        </div>
    </div>

    <!-- Â∫óÈì∫ÈÄâÊã©Ê®°ÊÄÅÊ°Ü -->
    <div id="storeModal" class="modal">
        <h3 style="text-align: center; color: black;">Select Store</h3>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 15px; margin-top: 20px;">
            <button onclick="selectStore('JKL')" style="width: 200px; height: 50px; font-size: 16px; background-color: black; color: white; border: none; border-radius: 5px; cursor: pointer;">JKL</button>
            <button onclick="selectStore('TOM')" style="width: 200px; height: 50px; font-size: 16px; background-color: black; color: white; border: none; border-radius: 5px; cursor: pointer;">TOM</button>
            <button onclick="selectStore('Ole-Ole')" style="width: 200px; height: 50px; font-size: 16px; background-color: black; color: white; border: none; border-radius: 5px; cursor: pointer;">Ole-Ole</button>
            <!-- Ê†πÊçÆÈúÄË¶ÅÊ∑ªÂä†Êõ¥Â§öÂ∫óÈì∫ÊåâÈíÆ -->
        </div>
    </div>

</body>

</html>
